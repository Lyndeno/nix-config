name: Update VSCode Extensions

on:
  push:
    paths:
      - 'programs/desktop/vscode/extensions/extensions'

  pull_request:
    branches: [ master ]

  workflow_run:
    workflows: ["Update Flake Inputs"]
    types:
      - completed

  workflow_dispatch:

jobs:
  check-flake:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2
      - name: Install Nix
        uses: cachix/install-nix-action@v17
        with:
          nix_path: nixpkgs=channel:nixos-unstable
      - name: Check Nix Flake
        run: ./programs/desktop/vscode/extensions/update.sh ./programs/desktop/vscode/extensions/extensions > ./programs/desktop/vscode/extensions/extensions.lock
      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          branch: master
          commit_message: Update extensions.lock
          commit_options: '--no-verify --signoff'
          file_pattern: ./programs/desktop/vscode/extensions/extensions.lock
          skip_dirty_check: false
          skip_fetch: true
